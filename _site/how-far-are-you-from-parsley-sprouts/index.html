<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Scottland is a front-end web developer whose clients have included nonprofits, progressive political organizations, and higher education.">

    <title>How Far Are You from Parsley & Sprouts? | Scottland Donaldson</title>

    <link rel="apple-touch-icon" sizes="57x57" href="/images/favi/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favi/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favi/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favi/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favi/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favi/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favi/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favi/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favi/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/images/favi/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favi/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favi/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favi/favicon-16x16.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="/css/main.css">

    <script src="/js/lib/modernizr-2.8.3.js"></script>
</head>


<body class="no-image post">

<div id="page">

    <header id="header" class="bg-primary">

        <div id="header-img" class="abs l0 t0 anim-fade lazy-load"></div>

        <div class="full-width">
            <nav class="no-underline">
                <ul>
                    <li class="nav-writing"><a href="/archives"><span>Articles</span></a></li>
                    <li class="nav-in-progress"><a href="/visuals"><span>Assorted Visuals</span></a></li>
                    <li>
                        <script>document.write('<a href="mailto:' + 'scott.p.' + 'dona' + 'ldson@gmai' + 'l.com' + '"><span>Email</span></a>');</script>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="abs b0 l0 w100">

            <div class="full-width">

                <h1 id="header-title">
                    <a class="bold caps no-underline" href="/" title="Scottland Donaldson" rel="home">Scottland Donaldson</a>
                </h1>

            </div>

        </div>

    </header>

    <main>


<div class="full-width">

    

    <div class="row container">

        <div class="two columns spacer"></div>

        <div class="eight columns">

            <h1 class="bold">How Far Are You from Parsley & Sprouts?</h1>
            <p data-date="2012-07-12 00:00:00 -0400" class="caption"></p>

            <p>Last Friday, Lisa and I launched the official Parsley &amp; Sprouts website, after having been freed from our day jobs and hard at work on it for several weeks. Since it’s our own site, we had the freedom to do with it whatever we wanted, so in addition to our design, branding, copy, and photos, there are plenty of fun details that we hope we’ll keep on building off of in the coming weeks and months. One of the pieces we were happiest about was the distance calculator on the About page.</p>

<p><img alt="Where can we find you?" src="http://scottdonaldson.net-assets.s3-website-us-east-1.amazonaws.com/2012/07/St-Paul-MN.png" class="aligncenter" /></p>

<p>By inputting your city and state, you can find out how far (in miles) you are from us — specifically, Lowertown St. Paul, right next to Golden’s Deli.</p>

<p>Initially I had envisioned using the Google Maps API (which I had just worked with a bit on another Parsley &amp; Sprouts project, the mobile site for College Park Car Wash). However, it turns out Google has some weird terms of service when it comes to using the API but not displaying actual Google maps, as well as needing to have their logo visible on the page. The solution turned out to be simpler.</p>

<p>I knew I would have to use some sort of autofill on the form — I figured if someone were trying to type in ‘Minneapolis’ but instead inputted ‘Minneaplois,’ there’s little chance it would work correctly (and even a slim chance that their typo could be an actual city somewhere else, in which case it would work, but calculate the <em>wrong</em> distance). In doing so, I stumbled on a <a href="https://github.com/agarzola/jQueryAutocompletePlugin">demo of a jQuery autocomplete plugin</a> that uses <a href="http://www.geonames.org/">GeoNames</a> — an online database with hundreds of thousands of entries of cities, countries, and other geographical entities — coincidentally, exactly what I was looking for!</p>

<p>You can check out the above demo to get a decent overview of setting up an input box that will autocomplete a city and state (within the U.S.), and allow the user to select it. The next step for was to figure out how to calculate the distance between the user’s selection and the Parsley &amp; Sprouts headquarters — needing the latitude and longitude of both locations. That was easy enough to find <a href="http://whatsmylatlng.com/">here</a> (to a scary amount of specificity). And fortunately, GeoNames data comes with latitude and longitude, so that information is retrieved whenever the user selects the city. So how do we get the distance between the two? The answer:</p>

<blockquote class="twitter-tweet" lang="en"><p>The haversine formula!</p>--- Scottland (@scottpdonaldson) <a href="https://twitter.com/scottpdonaldson/status/210800316592041984">June 7, 2012</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p><small>(I tweeted that out of sheer joy upon discovering that it was so [relatively] easy that there was a name for it.)</small></p>

<p>The mathematical formula itself goes like this:</p>

<p><img class="aligncenter" src="http://scottdonaldson.net-assets.s3-website-us-east-1.amazonaws.com/2012/07/haversine.png" /></p>

<p>Where <em>haversin</em> is the haversine function, defined by:</p>

<p><img class="aligncenter" src="http://scottdonaldson.net-assets.s3-website-us-east-1.amazonaws.com/2012/07/haversine-function.png" /></p>

<p>Those two equations are great, and easy enough if you’re working with raw numbers and a calculator, but not so great on the web. There we need JavaScript. I wasn’t about to go and recreate this from scratch, so fortunately I found an example over at <a href="http://www.movable-type.co.uk/scripts/latlong.html">Movable Type Scripts</a>. Here’s the original code:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="lineno"> 1</span> <span class="kd">var</span> <span class="nx">R</span> <span class="o">=</span> <span class="mi">6371</span><span class="p">;</span> <span class="c1">// km</span>
<span class="lineno"> 2</span> <span class="kd">var</span> <span class="nx">dLat</span> <span class="o">=</span> <span class="p">(</span><span class="nx">lat2</span><span class="o">-</span><span class="nx">lat1</span><span class="p">).</span><span class="nx">toRad</span><span class="p">();</span>
<span class="lineno"> 3</span> <span class="kd">var</span> <span class="nx">dLon</span> <span class="o">=</span> <span class="p">(</span><span class="nx">lon2</span><span class="o">-</span><span class="nx">lon1</span><span class="p">).</span><span class="nx">toRad</span><span class="p">();</span>
<span class="lineno"> 4</span> <span class="kd">var</span> <span class="nx">lat1</span> <span class="o">=</span> <span class="nx">lat1</span><span class="p">.</span><span class="nx">toRad</span><span class="p">();</span>
<span class="lineno"> 5</span> <span class="kd">var</span> <span class="nx">lat2</span> <span class="o">=</span> <span class="nx">lat2</span><span class="p">.</span><span class="nx">toRad</span><span class="p">();</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">dLat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">dLat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
<span class="lineno"> 8</span>         <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">dLon</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">dLon</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">lat1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">lat2</span><span class="p">);</span>
<span class="lineno"> 9</span> <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">atan2</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">a</span><span class="p">));</span>
<span class="lineno">10</span> <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">R</span> <span class="o">*</span> <span class="nx">c</span><span class="p">;</span></code></pre></div>

<p>The first step was to replace that 6,371 on the top line with 3,959 — the Earth’s radius in miles as opposed to kilometers (those pesky Brits). Next I replaced the instances of <code>lat1</code> and <code>lot1</code> with the latitude and longitude of Parsley &amp; Sprouts: 44.949316 and -93.086241. And rather than include the new function for converting to radians, I just replaced the four instances of it with its (relatively simple) execution, multiplying by pi and dividing by 180:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">180</span></code></pre></div>

<p>Almost there. The last step was to bring over the data from GeoNames. This meant adding two extra parameters, <code>lat</code> and <code>lng</code>, when calling the data for the city. So our new haversine formula, specific to the coordinates of Parsley &amp; Sprouts, became:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="lineno"> 1</span> <span class="kd">var</span> <span class="nx">R</span> <span class="o">=</span> <span class="mi">3959</span><span class="p">;</span> <span class="c1">// mi</span>
<span class="lineno"> 2</span> <span class="kd">var</span> <span class="nx">dLat</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">lat</span><span class="o">-</span><span class="mf">44.949316</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">180</span><span class="p">;</span>
<span class="lineno"> 3</span> <span class="kd">var</span> <span class="nx">dLon</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">lng</span><span class="o">+</span><span class="mf">93.086241</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">180</span><span class="p">;</span>
<span class="lineno"> 4</span> <span class="kd">var</span> <span class="nx">lat1</span> <span class="o">=</span> <span class="mf">44.949316</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">180</span><span class="p">;</span>
<span class="lineno"> 5</span> <span class="kd">var</span> <span class="nx">lat2</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">lat</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">180</span><span class="p">;</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(.</span><span class="mi">5</span><span class="o">*</span><span class="nx">dLat</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(.</span><span class="mi">5</span><span class="o">*</span><span class="nx">dLat</span><span class="p">)</span> <span class="p">)</span> <span class="o">+</span>
<span class="lineno"> 8</span>         <span class="p">(</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(.</span><span class="mi">5</span><span class="o">*</span><span class="nx">dLon</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(.</span><span class="mi">5</span><span class="o">*</span><span class="nx">dLon</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">lat1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">lat2</span><span class="p">)</span> <span class="p">);</span>
<span class="lineno"> 9</span> <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">atan2</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">a</span><span class="p">));</span>
<span class="lineno">10</span> <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">R</span> <span class="o">*</span> <span class="nx">c</span><span class="p">);</span></code></pre></div>

<p>Our output, <em>d</em>, is the distance as the crow flies between the selected city and where I’m sitting as I write this. Success! Now to figure out how to display the results in an interesting, meaningful way. It was Lisa’s idea to write different responses depending on how far great <em>d</em> ended up being. For example, if the user is less than 10 miles away (basically just St. Paul, Minneapolis, and a handful of suburbs), they get a result that reads, “You’re practically in our backyard! Ready to get started?” From there, moving up, there are different answers that reflect how far away the visitor is — from greater Minnesota all the way out to Alaska, thousands of miles away (we’re not yet doing business internationally…).</p>

        </div>
    </div>
</div>


</main>

<footer id="footer">

    <div class="section">

        <div class="full-width">
            <p><script>document.write('<a class="no-underline" href="mailto:' + 'scott.p.' + 'dona' + 'ldson@gmai' + 'l.com' + '"><span>Email</span></a>');</script><br>
            <a class="no-underline" href="https://github.com/scottdonaldson" target="_blank">GitHub</a><br>
            <a class="no-underline" href="https://twitter.com/scottpdonaldson" target="_blank">Twitter</a><br>
            <a class="no-underline" href="http://www.linkedin.com/in/scottpdonaldson" target="_blank">LinkedIn</a><br>
            <a class="no-underline" href="https://instagram.com/scottpdonaldson" target="_blank">Instagram</a></p>
            <p class="secondary">&copy; Scottland Donaldson 2008 to <script>document.write(new Date().getFullYear());</script></p>
        </div>

    </div>

</footer>

<script src="/js/lib/imagesloaded-3.1.8.js"></script>
<script src="/js/script.js"></script>
<script src="/js/conditions.js"></script>
<script src="/js/tumblr.js"></script>

<img src="/images/18.png" class="abs b0 r0 anim-fade lazy-load" id="footer-img">

</body>
</html>

